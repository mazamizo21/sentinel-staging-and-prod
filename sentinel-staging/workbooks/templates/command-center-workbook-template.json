{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 1,
      "content": {
        "json": "# üéØ Threat Intelligence Command Center\n\n## Real-Time Operational Dashboard\n\n**Features:**\n- üìä Real-Time Threat Monitoring\n- ‚ö° Threat Activity Timeline\n- üîç Statistical Analysis\n- üîó Cross-Feed Correlation\n\n**Data Sources:** Cyren Malware + TacitRed Credentials"
      },
      "name": "header-text"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "time-param",
            "version": "KqlParameterItem/1.0",
            "name": "TimeRange",
            "type": 4,
            "isRequired": true,
            "value": {
              "durationMs": 86400000
            },
            "typeSettings": {
              "selectableValues": [
                {
                  "durationMs": 3600000
                },
                {
                  "durationMs": 86400000
                },
                {
                  "durationMs": 604800000
                }
              ],
              "allowCustom": true
            },
            "label": "Time Range"
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "name": "parameters-1"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "// REAL-TIME THREAT SCORE TIMELINE\nunion withsource=TableName Cyren_Indicators_CL, TacitRed_Findings_CL\n| where TimeGenerated {TimeRange}\n| extend \n    ThreatScore = toint(iif(TableName == \"Cyren_Indicators_CL\", iif(isnull(risk_d), 50, risk_d), iif(isnull(confidence_d), 50, confidence_d))),\n    Source = case(TableName == \"Cyren_Indicators_CL\", \"Cyren\", \"TacitRed\")\n| summarize AvgThreatScore = avg(ThreatScore), Count = count() by bin(TimeGenerated, 1h), Source\n| order by TimeGenerated asc",
        "size": 0,
        "title": "üî• Real-Time Threat Score Timeline",
        "timeContext": {
          "durationMs": 0
        },
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "linechart"
      },
      "name": "query-timeline"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "// THREAT VELOCITY & ACCELERATION\nlet baseline = union Cyren_Indicators_CL, TacitRed_Findings_CL\n| where TimeGenerated between(ago(48h)..ago(24h))\n| summarize BaselineCount = count();\nlet current = union Cyren_Indicators_CL, TacitRed_Findings_CL\n| where TimeGenerated >= ago(24h)\n| summarize CurrentCount = count();\nbaseline\n| extend CurrentCount = toscalar(current)\n| extend \n    Velocity = CurrentCount - BaselineCount,\n    PercentChange = round(100.0 * (CurrentCount - BaselineCount) / BaselineCount, 2),\n    Trend = case(\n        CurrentCount > BaselineCount * 1.2, \"üìà Accelerating\",\n        CurrentCount < BaselineCount * 0.8, \"üìâ Decelerating\",\n        \"‚û°Ô∏è Stable\"\n    )\n| project Trend, Velocity, PercentChange, BaselineCount, CurrentCount",
        "size": 0,
        "title": "‚ö° Threat Velocity & Acceleration",
        "timeContext": {
          "durationMs": 172800000
        },
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "table"
      },
      "name": "query-velocity"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "// STATISTICAL ANOMALY DETECTION\nunion Cyren_Indicators_CL, TacitRed_Findings_CL\n| where TimeGenerated >= ago(7d)\n| summarize HourlyCount = count() by bin(TimeGenerated, 1h)\n| summarize \n    AvgCount = avg(HourlyCount),\n    StdDev = stdev(HourlyCount),\n    MaxCount = max(HourlyCount),\n    MinCount = min(HourlyCount)\n| extend \n    UpperThreshold = AvgCount + (2 * StdDev),\n    LowerThreshold = AvgCount - (2 * StdDev),\n    AnomalyStatus = case(\n        MaxCount > AvgCount + (2 * StdDev), \"‚ö†Ô∏è Anomaly Detected\",\n        \"‚úÖ Normal\"\n    )\n| project \n    AnomalyStatus,\n    AvgCount = round(AvgCount, 2),\n    StdDev = round(StdDev, 2),\n    UpperThreshold = round(UpperThreshold, 2),\n    MaxCount",
        "size": 0,
        "title": "üö® Statistical Anomaly Detection",
        "timeContext": {
          "durationMs": 604800000
        },
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "table"
      },
      "name": "query-anomaly"
    }
  ],
  "styleSettings": {},
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}
