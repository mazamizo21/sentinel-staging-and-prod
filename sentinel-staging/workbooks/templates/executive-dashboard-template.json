{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 1,
      "content": {
        "json": "# üìä Executive Risk Dashboard\n\n## Business Impact & Risk Visibility\n\n**Key Metrics:**\n- Overall Risk Level\n- Total Threats Detected\n- Active Threats (Last 48h)\n- 7-Day and 30-Day Trends\n\n**Data Sources:** Cyren Malware URLs + TacitRed Findings"
      },
      "name": "header-text"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "time-param",
            "version": "KqlParameterItem/1.0",
            "name": "TimeRange",
            "type": 4,
            "isRequired": true,
            "value": {
              "durationMs": 604800000
            },
            "typeSettings": {
              "selectableValues": [
                {
                  "durationMs": 86400000
                },
                {
                  "durationMs": 604800000
                },
                {
                  "durationMs": 2592000000
                }
              ],
              "allowCustom": true
            },
            "label": "Time Range"
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "name": "parameters-1"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "// OVERALL RISK METRICS\nlet CyrenData = Cyren_Indicators_CL\n| where TimeGenerated {TimeRange}\n| extend \n    Risk = toint(iif(isnull(risk_d), 50, risk_d)),\n    LastSeen = iif(isnull(lastSeen_t), TimeGenerated, lastSeen_t)\n| extend \n    IsActive = datetime_diff('hour', now(), LastSeen) <= 48\n| summarize \n    TotalThreats = count(),\n    ActiveThreats = countif(IsActive),\n    AvgRisk = avg(Risk)\n| extend Source = \"Cyren\";\nlet TacitRedData = TacitRed_Findings_CL\n| where TimeGenerated {TimeRange}\n| extend \n    Confidence = todouble(iif(isnull(confidence_d), 50, confidence_d)),\n    LastSeen = iif(isnull(lastSeen_t), TimeGenerated, lastSeen_t)\n| extend \n    IsActive = datetime_diff('hour', now(), LastSeen) <= 48\n| summarize \n    TotalThreats = count(),\n    ActiveThreats = countif(IsActive),\n    AvgRisk = avg(Confidence)\n| extend Source = \"TacitRed\";\nunion CyrenData, TacitRedData\n| summarize \n    TotalThreats = sum(TotalThreats),\n    TotalActive = sum(ActiveThreats),\n    WeightedAvgRisk = avg(AvgRisk)\n| extend \n    OverallRiskLevel = case(\n        TotalActive >= 50, \"üî¥ Critical\",\n        TotalActive >= 25, \"üü† High\",\n        TotalActive >= 10, \"üü° Elevated\",\n        \"üü¢ Normal\"\n    )\n| project \n    OverallRiskLevel,\n    TotalThreats,\n    ActiveThreats = TotalActive,\n    WeightedAvgRisk = round(WeightedAvgRisk, 2)",
        "size": 0,
        "title": "üìä Overall Risk Assessment",
        "timeContext": {
          "durationMs": 0
        },
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "table"
      },
      "name": "query-overall-risk"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "// 30-DAY THREAT TREND\nunion withsource=TableName Cyren_Indicators_CL, TacitRed_Findings_CL\n| where TimeGenerated >= ago(30d)\n| extend Source = case(\n    TableName == \"Cyren_Indicators_CL\", \"Cyren\",\n    \"TacitRed\"\n)\n| summarize Count = count() by bin(TimeGenerated, 1d), Source\n| order by TimeGenerated asc",
        "size": 0,
        "title": "üìà 30-Day Threat Trend",
        "timeContext": {
          "durationMs": 2592000000
        },
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "areachart"
      },
      "name": "query-trend"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "// SLA PERFORMANCE METRICS\nlet SLATarget = 4.0;\nCyren_Indicators_CL\n| where TimeGenerated >= ago(7d)\n| extend \n    DetectionTime = TimeGenerated,\n    ReportedTime = iif(isnull(lastSeen_t), TimeGenerated, lastSeen_t)\n| extend ResponseTimeHours = datetime_diff('hour', ReportedTime, DetectionTime)\n| summarize \n    AvgResponseTime = avg(ResponseTimeHours),\n    MaxResponseTime = max(ResponseTimeHours),\n    SLACompliance = round(100.0 * countif(ResponseTimeHours <= SLATarget) / count(), 2)\n| extend \n    SLAStatus = case(\n        SLACompliance >= 95, \"‚úÖ Excellent\",\n        SLACompliance >= 85, \"‚úîÔ∏è Good\",\n        SLACompliance >= 75, \"‚ö†Ô∏è Needs Improvement\",\n        \"‚ùå Critical\"\n    )\n| project \n    SLAStatus,\n    SLACompliance,\n    AvgResponseTime = round(AvgResponseTime, 2),\n    MaxResponseTime = round(MaxResponseTime, 2)",
        "size": 0,
        "title": "üéØ SLA Performance Metrics",
        "timeContext": {
          "durationMs": 604800000
        },
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "table"
      },
      "name": "query-sla"
    }
  ],
  "styleSettings": {},
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}
