and was unexpected at this time.
D:\REPO\Upwork-Clean\Sentinel-Full-deployment-production\sentinel-staging>  "C:\Program Files\Microsoft SDKs\Azure\CLI2\wbin\\..\python.exe" -IBm azure.cli monitor log-analytics query --workspace 29372834-8f23-4eb3-86b6-476f7897fbf8 --analytics-query "  let lookbackPeriod = 7d; let cyrenActiveWindow = 48h; // Consider Cyren indicators active if seen in last 48 hours let CompromisedDomains = TacitRed_Findings_CL     | extend Email = tostring(email_s),              Username = tostring(coalesce(username_s, email_s)),              Domain = tostring(domain_s),              FindingType = tostring(findingType_s),              Confidence = todouble(confidence_d),              FirstSeen = todatetime(firstSeen_t),              LastSeen = todatetime(lastSeen_t),              Notes = tostring(notes_s),              Source = tostring(source_s),              Severity = tostring(severity_s),              Status = tostring(status_s),              IsRecent = datetime_diff('hour', now(), todatetime(lastSeen_t)) <= 48     | where TimeGenerated >= ago(lookbackPeriod)     | where isnotempty(Domain)     | summarize          CompromisedUsers = make_set(Email),         UserCount = dcount(Email),         FirstCompromise = min(FirstSeen),         LatestCompromise = max(LastSeen),         FindingTypes = make_set(FindingType),         AvgConfidence = avg(Confidence)         by Domain; let ActiveMaliciousInfra = Cyren_Indicators_CL     | extend Url = tostring(url_s),              Ip = tostring(ip_s),              FileHash = tostring(fileHash_s),              Domain = tostring(domain_s),              Protocol = tostring(protocol_s),              Port = toint(port_d),              Category = tostring(category_s),              RiskScore = toint(risk_d),              FirstSeen = todatetime(firstSeen_t),              LastSeen = todatetime(lastSeen_t),              Source = tostring(source_s),              Type = tostring(type_s),              Identifier = tostring(identifier_s)     | where TimeGenerated >= ago(lookbackPeriod)     | where LastSeen >= ago(cyrenActiveWindow) // Active in last 48 hours     | where RiskScore >= 60 // Medium risk or higher     | extend MaliciousDomain = case(         IOCType == "Domain", Domain,         IOCType == "URL", tostring(parse_url(URL).Host),         ""     )     | where isnotempty(MaliciousDomain)     | summarize          MaliciousIOCs = make_set(IOC),         IOCTypes = make_set(IOCType),         Categories = make_set(Category),         MaxRiskScore = max(RiskScore),         FirstSeen = min(FirstSeen),         LastSeen = max(LastSeen)         by MaliciousDomain; CompromisedDomains | join kind=inner (ActiveMaliciousInfra) on $left.Domain == $right.MaliciousDomain | extend     Severity = case(         MaxRiskScore >= 80 and AvgConfidence >= 80, "Critical",         MaxRiskScore >= 60 or AvgConfidence >= 80, "High",         "Medium"     ),     ThreatDescription = strcat(         "Domain ", Domain, " has ", UserCount, " compromised users (TacitRed) and is actively hosting malicious content (Cyren). ",         "Cyren risk score: ", MaxRiskScore, ". ",         "TacitRed confidence: ", round(AvgConfidence, 0), "%. ",         "This indicates active exploitation of compromised credentials."     ) | project     Domain,     Severity,     CompromisedUsers,     UserCount,     LatestCompromise,     MaliciousIOCs,     IOCTypes,     Categories,     MaxRiskScore,     AvgConfidence,     FindingTypes,     ThreatDescription,     CyrenFirstSeen = FirstSeen1,     CyrenLastSeen = LastSeen1 | order by Severity desc, UserCount desc  " --timespan P30D -o table
